<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Safe Zone Clock</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1c1c2e;
      color: #fff;
      text-align: center;
      padding: 5em 1em;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 0.5em;
    }
    #zones {
      font-size: 1.5em;
      color: #00ffd1;
    }
    #timer {
      margin-top: 1em;
      font-size: 1.3em;
      color: #ffd700;
    }
  </style>
</head>
<body>

  <h1>Current Safe Zone(s):</h1>
  <div id="zones">Loading...</div>
  <div id="timer">Calculating...</div>

  <script>
    const locations = [
      "Lunch Room",
      "Mastery Room",
      "9th Floor Commons", 
      "536 Entrance", 
      "259 First Floor",
      "901 Classroom", 
      "All Commons"
    ];

    const SLOT_DURATION_MINUTES = 6; // 10 slots in an hour
    const SLOT_DURATION_MS = SLOT_DURATION_MINUTES * 60 * 1000;

    function getCurrentSafeZones() {
      const now = new Date();
      const startOfHour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours());
      const minutesIntoHour = now.getMinutes();
      const currentSlot = Math.floor(minutesIntoHour / SLOT_DURATION_MINUTES);

      const zones = [];

      // Each location is assigned to one slot per hour (cyclically)
      locations.forEach((loc, i) => {
        const assignedSlot = i % (60 / SLOT_DURATION_MINUTES);
        if (assignedSlot === currentSlot) {
          zones.push(loc);
        }
      });

      const slotEndTime = new Date(startOfHour.getTime() + (currentSlot + 1) * SLOT_DURATION_MS);

      return { zones, slotEndTime };
    }

    function updateCountdown(endTime) {
      const timerEl = document.getElementById("timer");

      function refresh() {
        const now = new Date();
        const remaining = Math.max(0, endTime - now);
        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);

        timerEl.textContent = `Time remaining in this safe window: ${minutes}m ${seconds}s`;

        if (remaining <= 0) {
          clearInterval(interval);
          initialize(); // Refresh safe zone on expiration
        }
      }

      refresh();
      const interval = setInterval(refresh, 1000);
    }

    function initialize() {
      const { zones, slotEndTime } = getCurrentSafeZones();
      document.getElementById("zones").textContent = zones.join(", ");
      updateCountdown(slotEndTime);
    }

    initialize();
  </script>
</body>
</html>
